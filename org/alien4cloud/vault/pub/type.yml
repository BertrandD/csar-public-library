tosca_definitions_version: alien_dsl_1_4_0

metadata:
  template_name: org.alien4cloud.vault.pub
  template_version: 1.4.0-SNAPSHOT
  template_author: alien4cloud

imports:
  - tosca-normative-types:1.0.0-ALIEN14

node_types:
  org.alien4cloud.vault.pub.nodes.VaultServer:
    abstract: true
    derived_from: tosca.nodes.SoftwareComponent
    description: >
      Vault server installation.
    tags:
      icon: /images/vault.png
    capabilities:
      consul_agent:
        type: org.alien4cloud.vault.pub.capabilities.ConsulAgent
        valid_source_types: [org.alien4cloud.vault.pub.capabilities.ConsulClient]
    properties:
      download_url:
        description: The URL to download the vault archive.
        type: string
        required: true
        default: https://releases.hashicorp.com/vault/0.8.3/vault_0.8.3_linux_amd64.zip
      data_dir:
        description: The location on the FS where vault will store data.
        type: string
        required: true
        default: /var/vault
      # tls_enabled:
      #   description: Defines if the communication with the consul agent will be secured (HTTPS).
      #   type: boolean
      #   required: true
      #   default: false
      # ca_passphrase:
      #   description: The provided CA certificate passphrase.
      #   type: string
      #   required: false
      # encrypt_key:
      #   description: The key to encrypt gossip exchanges into consul cluster.
      #   type: string
      #   required: false
    capabilities:
      consul_server:
        type: org.alien4cloud.vault.pub.capabilities.VaultServer
        valid_source_types: [org.alien4cloud.vault.pub.capabilities.ConsulClient]

capability_types:
  org.alien4cloud.vault.pub.capabilities.VaultServer:
    derived_from: tosca.capabilities.Root
    description: >
      Exposed by a vault server agent.
  org.alien4cloud.vault.pub.capabilities.VaultClient:
    derived_from: tosca.capabilities.Endpoint
    description: >
      The capability to connect to a vault client using the vault API.
    # properties:
    #   tls_enabled:
    #     type: boolean
    #     description: indicates if the connection will be secured (HTTPS)
    #     required: false
    #     default: false
    #   ca_passphrase:
    #     type: string
    #     description: the passphrase for the CA certificate
    #     required: false
